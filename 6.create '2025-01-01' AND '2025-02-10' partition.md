ржпржжрж┐ query рж╣рзЯ:

### ЁЯФН **`created_at` BETWEEN '2025-01-01' AND '2025-02-10'`**

рждрж╛рж╣рж▓рзЗ Partitioning + Indexing ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗ?

ржЖржорж┐ ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ 100% ржкрж░рж┐рж╖рзНржХрж╛рж░ ржХрж░рзЗ ржмрзБржЭрж┐рзЯрзЗ ржжрж┐ржЪрзНржЫрж┐ред
ржПржЯрж╛ржЗ PostgreSQL-ржПрж░ рж╕ржмржЪрзЗрзЯрзЗ important concept: **Partition Pruning + Local Index Scan**

---

# ЁЯза рзз) Data partitions ржХрзЗржоржи ржзрж░рзЗ ржирж┐ржЪрзНржЫрж┐?

ржзрж░рж┐тАФрждрзБржорж┐ monthly partition ржХрж░рзЗржЫрзЛ:

```
users_2025_01   (2025-01-01 тЖТ 2025-02-01)
users_2025_02   (2025-02-01 тЖТ 2025-03-01)
users_2025_03   (...)
```

ржПржнрж╛ржмрзЗтАж

---

# ЁЯза рзи) Query:

```sql
SELECT *
FROM users
WHERE created_at BETWEEN '2025-01-01' AND '2025-02-10';
```

ржПржЦржи PostgreSQL рждрж┐ржи ржзрж╛ржкрзЗ ржХрж╛ржЬ ржХрж░ржмрзЗред

---

# тЬЕ **StepтАУ1: Partition Pruning**

### PostgreSQL ржжрзЗржЦрзЗ ржХрзЛржи partition ржЧрзБрж▓рзЛ ржПржЗ рж░рзЗржЮрзНржЬрзЗрж░ ржоржзрзНржпрзЗ ржкрзЬрзЗ:

| Partition     | Range                       | Needed?                             |
| ------------- | --------------------------- | ----------------------------------- |
| users_2025_01 | тАШ2025-01-01тАЩ тЖТ тАШ2025-02-01тАЩ | тЬФ ржЕржирзНрждрж░рзНржнрзБржХрзНржд                       |
| users_2025_02 | тАШ2025-02-01тАЩ тЖТ тАШ2025-03-01тАЩ | тЬФ ржЕржирзНрждрж░рзНржнрзБржХрзНржд (рззрзж ржлрзЗржм ржкрж░рзНржпржирзНржд рж▓рж╛ржЧрзЗ) |
| users_2025_03 | ржорж╛рж░рзНржЪ partition             | тЭМ рж▓рж╛ржЧржмрзЗ ржирж╛                          |

### рждрж╛ржЗ PostgreSQL рж╢рзБржзрзБржорж╛рждрзНрж░ **рзиржЯрж┐ partition** рж╕рзНржХрзНржпрж╛ржи ржХрж░ржмрзЗ:

```
users_2025_01
users_2025_02
```

---

# тЬЕ **StepтАУ2: Local Index Scan (per partition)**

ржкрзНрж░рждрж┐ partition-ржП ржЖрж▓рж╛ржжрж╛ index ржерж╛ржХрзЗ:

```
idx_users_2025_01_created_at
idx_users_2025_02_created_at
```

Query рж╣рж▓рзЗ:

* `users_2025_01` тЖТ ржЫрзЛржЯ index тЖТ ржЦрзБржм ржжрзНрж░рзБржд
* `users_2025_02` тЖТ ржЫрзЛржЯ index тЖТ ржЦрзБржм ржжрзНрж░рзБржд

тЪб Full table ржХржЦржирзЛржЗ scan рж╣ржмрзЗ ржирж╛
тЪб Whole-year index ржХржЦржирзЛржЗ ржмрзНржпржмрж╣рж╛рж░ рж╣ржмрзЗ ржирж╛

---

# тЬЕ **StepтАУ3: PostgreSQL result merge ржХрж░рзЗ ржжрзЗржмрзЗ**

рззржо partition-ржПрж░ рж░рзЗржЬрж╛рж▓рзНржЯ
+
рзирзЯ partition-ржПрж░ рж░рзЗржЬрж╛рж▓рзНржЯ
тЖТ рж╕рж╛ржЬрж┐рзЯрзЗ final output ржжрзЗрзЯред

---

# ЁЯУМ Summary (ржПржХ ржХржерж╛рзЯ)

### тЬФ рждрзБржорж┐ рж░рзЗржЮрзНржЬ ржжрж┐рзЯрзЗржЫрзЛ: Jan 1 тЖТ Feb 10

### тЬФ PostgreSQL **рж╢рзБржзрзБ Jan + Feb partition** scan ржХрж░ржмрзЗ

### тЬФ ржкрзНрж░рждрж┐ржЯрж┐ partition-ржПрж░ **ржирж┐ржЬрж╕рзНржм index** ржмрзНржпржмрж╣рж╛рж░ рж╣ржмрзЗ

### тЬФ ржЕржирзНржп partition (March, AprilтАж) рж╕рзНржХрзНржпрж╛ржи рж╣ржмрзЗ ржирж╛

тЮб ржлрж▓рзЗ Query **50x Faster** рж╣рзЯред

---

# ЁЯОп Example Visualization

```
users (parent)
 тФЬтФАтФА users_2025_01   <-- scanned, indexed
 тФЬтФАтФА users_2025_02   <-- scanned, indexed
 тФЬтФАтФА users_2025_03   <-- skipped
 тФЬтФАтФА users_2025_04   <-- skipped
 ...
```

ржПржЯрж╛ржЗ Partitioning + Indexing-ржПрж░ ржЬрж╛ржжрзБред

---

# тнР BONUS: Performance Comparison

### тЭМ Without Partitioning:

```
Scan huge table (millions rows)
Index is huge тЖТ slow
```

### тЬФ With Partitioning:

```
Scan only Jan + Feb partitions (maybe 200k rows)
Index tiny тЖТ very fast
```

---

# тЭУ ржЪрж╛ржЗрж▓рзЗ ржЖржорж┐ рждрзЛржорж╛ржХрзЗ Query Planner ржПрж░ outputржУ ржжрзЗржЦрж╛рждрзЗ ржкрж╛рж░рж┐

ржпрзЗржоржи:

```
EXPLAIN SELECT ...
```

ржПрждрзЗ ржжрзЗржЦрж╛ ржпрж╛ржмрзЗ PostgreSQL ржХрзАржнрж╛ржмрзЗ partition prune ржХрж░рзЗржЫрзЗ ржУ ржХрзЛржи index ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗржЫрзЗред

ржмрж▓рж▓рзЗржЗ ржжрж┐рзЯрзЗ ржжрзЗржмред
